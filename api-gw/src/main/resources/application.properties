server.port=9090

# Niveles de log
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.reactor.netty=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springdoc=DEBUG

# ============================================
# CONFIGURACIÓN DE SEGURIDAD
# ============================================
# URI del JWK Set de Keycloak para la validación de tokens
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://keycloak:8080/realms/tesina/protocol/openid-connect/certs

# ============================================
# CONFIGURACIÓN DE SWAGGER / OPENAPI
# ============================================
# Habilitar Swagger UI en el gateway
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.enabled=true

# URLs de los microservicios para agregar a Swagger
springdoc.swagger-ui.urls[0].name=Users Service
springdoc.swagger-ui.urls[0].url=/v3/api-docs/usuarios

springdoc.swagger-ui.urls[1].name=Proyectos Service
springdoc.swagger-ui.urls[1].url=/v3/api-docs/proyectos

# Configuración para que el gateway exponga los docs de los microservicios
springdoc.api-docs.path=/v3/api-docs

# ============================================
# ENRUTAMIENTO - USERS SERVICE
# ============================================
# Ruta para Users Service
spring.cloud.gateway.routes[0].id=users-service
spring.cloud.gateway.routes[0].uri=http://users-service:9091
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/usuarios/**,/api/auth/**

# Ruta para exponer OpenAPI docs del Users Service
spring.cloud.gateway.routes[1].id=users-service-docs
spring.cloud.gateway.routes[1].uri=http://users-service:9091
spring.cloud.gateway.routes[1].predicates[0]=Path=/v3/api-docs/usuarios
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/v3/api-docs/usuarios,/v3/api-docs

# ============================================
# ENRUTAMIENTO - PROYECTOS SERVICE
# ============================================
# Ruta principal para Proyectos Service
spring.cloud.gateway.routes[2].id=proyectos-service
spring.cloud.gateway.routes[2].uri=http://proyectos-service:9092
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/logos/**,/api/materiales/**,/api/tipos-bolsa/**,/api/plantillas/**,/api/disenos/**

# Ruta para exponer OpenAPI docs del Proyectos Service
spring.cloud.gateway.routes[3].id=proyectos-service-docs
spring.cloud.gateway.routes[3].uri=http://proyectos-service:9092
spring.cloud.gateway.routes[3].predicates[0]=Path=/v3/api-docs/proyectos
spring.cloud.gateway.routes[3].filters[0]=RewritePath=/v3/api-docs/proyectos,/v3/api-docs

# ============================================
# ACTUATOR
# ============================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always
management.health.defaults.enabled=true

# ============================================
# RATE LIMITING
# ============================================
# Límites por defecto
app.rate-limit.default-capacity=20
app.rate-limit.default-refill-tokens=10

# Límites personalizados para Users Service
app.rate-limit.routes[/api/usuarios/create].capacity=10
app.rate-limit.routes[/api/usuarios/create].refill-tokens=5
app.rate-limit.routes[/api/usuarios/list/**].capacity=40
app.rate-limit.routes[/api/usuarios/list/**].refill-tokens=20

# Límites personalizados para Proyectos Service
# Logos - operaciones de creación más restrictivas
app.rate-limit.routes[/api/logos].capacity=15
app.rate-limit.routes[/api/logos].refill-tokens=10

# Diseños - operaciones de creación más restrictivas (archivos pesados)
app.rate-limit.routes[/api/disenos].capacity=10
app.rate-limit.routes[/api/disenos].refill-tokens=5

# Plantillas - operaciones de creación más restrictivas
app.rate-limit.routes[/api/plantillas].capacity=10
app.rate-limit.routes[/api/plantillas].refill-tokens=5

# Listados - más permisivos
app.rate-limit.routes[/api/logos/usuario/**].capacity=30
app.rate-limit.routes[/api/logos/usuario/**].refill-tokens=20
app.rate-limit.routes[/api/disenos/usuario/**].capacity=30
app.rate-limit.routes[/api/disenos/usuario/**].refill-tokens=20
app.rate-limit.routes[/api/plantillas/**].capacity=30
app.rate-limit.routes[/api/plantillas/**].refill-tokens=20

# Catálogos (Materiales, Tipos de Bolsa) - muy permisivos (son operaciones ligeras)
app.rate-limit.routes[/api/materiales/**].capacity=50
app.rate-limit.routes[/api/materiales/**].refill-tokens=30
app.rate-limit.routes[/api/tipos-bolsa/**].capacity=50
app.rate-limit.routes[/api/tipos-bolsa/**].refill-tokens=30