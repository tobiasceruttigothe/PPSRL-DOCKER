server.port=9090

# Niveles de log
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.reactor.netty=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springdoc=DEBUG

# ============================================
# CONFIGURACIÓN DE SEGURIDAD
# ============================================
# URI del JWK Set de Keycloak para la validación de tokens
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://keycloak:8080/realms/tesina/protocol/openid-connect/certs

# ============================================
# CONFIGURACIÓN DE SWAGGER / OPENAPI
# ============================================
# Habilitar Swagger UI en el gateway
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.enabled=true

# URLs de los microservicios para agregar a Swagger
# Esto le dice a Swagger dónde encontrar la documentación de cada microservicio
springdoc.swagger-ui.urls[0].name=Users Service
springdoc.swagger-ui.urls[0].url=/v3/api-docs/usuarios

# Configuración para que el gateway exponga los docs de los microservicios
springdoc.api-docs.path=/v3/api-docs

# ============================================
# ENRUTAMIENTO EXPLÍCITO
# ============================================
# Definir rutas explícitamente (más control que discovery automático)

# Ruta para Users Service
spring.cloud.gateway.routes[0].id=users-service
spring.cloud.gateway.routes[0].uri=http://users-service:9091
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/usuarios/**,/api/auth/**

# Ruta para exponer OpenAPI docs del Users Service
spring.cloud.gateway.routes[1].id=users-service-docs
spring.cloud.gateway.routes[1].uri=http://users-service:9091
spring.cloud.gateway.routes[1].predicates[0]=Path=/v3/api-docs/usuarios
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/v3/api-docs/usuarios,/v3/api-docs

# ============================================
# OTROS
# ============================================
# Actuator
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always
management.health.defaults.enabled=true

# Rate limiting (sin cambios)
app.rate-limit.default-capacity=20
app.rate-limit.default-refill-tokens=10
app.rate-limit.routes[/api/usuarios/create].capacity=10
app.rate-limit.routes[/api/usuarios/create].refill-tokens=5
app.rate-limit.routes[/api/usuarios/list/**].capacity=40
app.rate-limit.routes[/api/usuarios/list/**].refill-tokens=20